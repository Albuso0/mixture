

##### k=2
g2 <- function(u,x) { # u = x1,x2,p1
    g1 <- u[3]*u[1]   + (1-u[3])*u[2]   -x
    g2 <- u[3]*u[1]^2 + (1-u[3])*u[2]^2 -(x^2-1)
    g3 <- u[3]*u[1]^3 + (1-u[3])*u[2]^3 -(x^3-3*x)
    f <- cbind(g1,g2,g3)
    return(f)
}
#### inequality constraints in k=2: ui*u >= ci
ui2 = rbind(c(0,0,1),
           c(0,0,-1))
ci2 = c(0,-1)





##### k=3
g3 <- function(u,x) { # u = x1,x2,x3,p1,p2
    f1 <- u[4]*u[1]   + u[5]*u[2]   +(1-u[4]-u[5])*u[3]   -x
    f2 <- u[4]*u[1]^2 + u[5]*u[2]^2 +(1-u[4]-u[5])*u[3]^2 -(x^2-1)
    f3 <- u[4]*u[1]^3 + u[5]*u[2]^3 +(1-u[4]-u[5])*u[3]^3 -(x^3-3*x)
    f4 <- u[4]*u[1]^4 + u[5]*u[2]^4 +(1-u[4]-u[5])*u[3]^4 -(x^4-6*x^2+3)
    f5 <- u[4]*u[1]^5 + u[5]*u[2]^5 +(1-u[4]-u[5])*u[3]^5 -(x^5-10*x^3+15*x)
    f <- cbind(f1,f2,f3,f4,f5)
    return(f)
}
#### inequality constraints in k=3: ui*u >= ci
ui3 = rbind(c(0,0,0,1,0),
           c(0,0,0,-1,0),
           c(0,0,0,0,1),
           c(0,0,0,0,-1),
           c(0,0,0,-1,-1))
ci3 = c(0,-1,0,-1,-1)




##### k=4
g4 <- function(u,x) { # u = x1,x2,x3,x4,p1,p2,p3
    f1 <- u[5]*u[1]   + u[6]*u[2]   +u[7]*u[3]   + (1-u[5]-u[6]-u[7])*u[4]   -x
    f2 <- u[5]*u[1]^2 + u[6]*u[2]^2 +u[7]*u[3]^2 + (1-u[5]-u[6]-u[7])*u[4]^2 -(x^2-1)
    f3 <- u[5]*u[1]^3 + u[6]*u[2]^3 +u[7]*u[3]^3 + (1-u[5]-u[6]-u[7])*u[4]^3 -(x^3-3*x)
    f4 <- u[5]*u[1]^4 + u[6]*u[2]^4 +u[7]*u[3]^4 + (1-u[5]-u[6]-u[7])*u[4]^4 -(x^4-6*x^2+3)
    f5 <- u[5]*u[1]^5 + u[6]*u[2]^5 +u[7]*u[3]^5 + (1-u[5]-u[6]-u[7])*u[4]^5 -(x^5-10*x^3+15*x)
    f6 <- u[5]*u[1]^6 + u[6]*u[2]^6 +u[7]*u[3]^6 + (1-u[5]-u[6]-u[7])*u[4]^6 -(x^6-15*x^4+45*x^2-15)
    f7 <- u[5]*u[1]^7 + u[6]*u[2]^7 +u[7]*u[3]^7 + (1-u[5]-u[6]-u[7])*u[4]^7 -(x^7-21*x^5+105*x^3-105*x)
    f <- cbind(f1,f2,f3,f4,f5,f6,f7)
    return(f)
}
#### inequality constraints in k=4: ui*u >= ci
ui4 = rbind(c(0,0,0,0,1,0,0),
           c(0,0,0,0,-1,0,0),
           c(0,0,0,0,0,1,0),
           c(0,0,0,0,0,-1,0),
           c(0,0,0,0,0,0,1),
           c(0,0,0,0,0,0,-1),
           c(0,0,0,0,-1,-1,-1))
ci4 = c(0,-1,0,-1,0,-1,-1)



##### k=5
g5 <- function(u,x) { # u = x1,x2,x3,x4,x5,p1,p2,p3
    f1 <- u[6]*u[1]   + u[7]*u[2]   +u[8]*u[3]   + u[9]*u[4]   + (1-u[6]-u[7]-u[8]-u[9])*u[5]   -x
    f2 <- u[6]*u[1]^2 + u[7]*u[2]^2 +u[8]*u[3]^2 + u[9]*u[4]^2 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^2 -(x^2-1)
    f3 <- u[6]*u[1]^3 + u[7]*u[2]^3 +u[8]*u[3]^3 + u[9]*u[4]^3 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^3 -(x^3-3*x)
    f4 <- u[6]*u[1]^4 + u[7]*u[2]^4 +u[8]*u[3]^4 + u[9]*u[4]^4 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^4 -(x^4-6*x^2+3)
    f5 <- u[6]*u[1]^5 + u[7]*u[2]^5 +u[8]*u[3]^5 + u[9]*u[4]^5 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^5 -(x^5-10*x^3+15*x)
    f6 <- u[6]*u[1]^6 + u[7]*u[2]^6 +u[8]*u[3]^6 + u[9]*u[4]^6 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^6 -(x^6-15*x^4+45*x^2-15)
    f7 <- u[6]*u[1]^7 + u[7]*u[2]^7 +u[8]*u[3]^7 + u[9]*u[4]^7 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^7 -(x^7-21*x^5+105*x^3-105*x)
    f8 <- u[6]*u[1]^8 + u[7]*u[2]^8 +u[8]*u[3]^8 + u[9]*u[4]^8 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^8 -(x^8-28*x^6+210*x^4-420*x^2+105)
    f9 <- u[6]*u[1]^9 + u[7]*u[2]^9 +u[8]*u[3]^9 + u[9]*u[4]^9 + (1-u[6]-u[7]-u[8]-u[9])*u[5]^9 -(x^9-36*x^7+378*x^5-1260*x^3+945*x)
    f <- cbind(f1,f2,f3,f4,f5,f6,f7,f8,f9)
    return(f)
}
#### inequality constraints in k=5: ui*u >= ci
ui5 = rbind(c(0,0,0,0,0,1,0,0,0),
           c(0,0,0,0,0,-1,0,0,0),
           c(0,0,0,0,0,0,1,0,0),
           c(0,0,0,0,0,0,-1,0,0),
           c(0,0,0,0,0,0,0,1,0),
           c(0,0,0,0,0,0,0,-1,0),
           c(0,0,0,0,0,0,0,0,1),
           c(0,0,0,0,0,0,0,0,-1),
           c(0,0,0,0,0,-1,-1,-1,-1))
ci5 = c(0,-1,0,-1,0,-1,0,-1,-1)




## g1 <- function(tet,x)
## {
##     m1 <- (tet[1]-x)
##     m2 <- (tet[2]^2 - (x - tet[1])^2)
##     m3 <- x^3-tet[1]*(tet[1]^2+3*tet[2]^2)
##     f <- cbind(m1,m2,m3)
##     ## f <- cbind(m1,m2)
##     return(f)
## }


 


moment <- function(distribution, deg) { # p1,x1,p2,x2...
    l <- as.integer(length(distribution)/2)
    M <- integer(deg)
    p <- distribution[c(TRUE, FALSE)]
    x <- distribution[c(FALSE, TRUE)]

    monom <- 1

    for(i in 1:deg){
        monom <- monom * x
        M[i] <- sum(p*monom)
    }

    return(M)
}

hermite <- function(x, deg) {
    H <- integer(deg)
    pp <- 0
    p <- 1
    for (i in 1:deg){
        H[i] <- x*p - (i-1)*pp ## recursion: H_{n+1}(x) = x * H_n(x) - n * H_{n-1}(x)
        pp <- p
        p <- H[i]
    }
    return(H)
}
